<template name="Topics">
    <div class="container-fluid">
        {{> pageElement key="topic"}}
        <div class="row">
            {{#if can "add-topic" "topic"}}
                {{#jkafModal class="btn btn-success" template="addTopicModalForm" id="addTopicModalForm"}}
                    <span class="fa fa-plus">
                        {{_ "Add new"}}
                    </span>
                {{/jkafModal}}
            {{/if}}
        </div>
        <hr>
        <div class="row topics">
            {{> TopicList}}
        </div>
    </div>
</template>

<template name="TopicList">
    <input class="refineSearch form-control" placeholder="{{_ 'Search'}}" autofocus="autofocus">
    <ul class="list-unstyled parentTopicList">
        {{#each topics}}
            {{> SingleTopic}}
        {{else}}
            {{_ "No topics found!"}}
        {{/each}}
    </ul>
</template>

<template name="SingleTopic">
    <li id="{{_id}}" class="topic-li">
        {{#if subTopicCount _id}}
            {{#if isExpand _id}}
                <i class="fa fa-minus" type="button"></i>
            {{else}}
                <i class="fa fa-plus" type="button"></i>
            {{/if}}
        {{/if}}
        {{> TopicButtons}}
        <hr>

        {{#each subTopics _id}}
            <ul style="display:{{#if isParentExpand _id}}block;{{else}}none;{{/if}}">
                {{> SingleTopic}}
            </ul>
        {{/each}}

    </li>
</template>

<template name="updateTopicModalForm">
    {{#autoForm collection="Topics" id="updateTopicModalForm" doc=this type="update" buttonContent=getUpdateButtonContent}}
        {{> afQuickField name="name" }}
        {{> afQuickField name="englishName" }}
        {{> afQuickField name='relatedTopics' options=topics type="universe-select" multiple=true}}
        <button type="submit" class="btn btn-primary">{{_ "Update"}}</button>
    {{/autoForm}}
</template>

<template name="deleteTopicModalForm">
    {{#afModal class="fa fa-trash" collection="Topics" operation="remove" doc=_id prompt=getPrompt buttonContent=getDeleteButtonContent title=getDeleteButtonContent}}
    {{/afModal}}
</template>

<template name="addTopicModalForm">
    {{#autoForm collection="Topics" id="addTopicModalForm" type="insert" buttonContent=getCreateButtonContent}}
        {{> afQuickField name="name" }}
        {{> afQuickField name="englishName" }}
        {{> afQuickField name='relatedTopics' options=topics type="universe-select" multiple=true}}
        <button type="submit" class="btn btn-primary">{{_ "Add new"}}</button>
    {{/autoForm}}
</template>

<template name="TopicButtons">
    <a href="/topic/{{translateThis name englishName}}">
        {{translateThis name englishName}}
    </a>

    <div class="pull-right">
        {{#if can "add-topic" "topic" }}
            {{>jkafModal class="fa fa-plus" template="addTopicModalForm" id="addTopicModalForm"}}
        {{/if}}
        {{#if can "modify-topic" "topic" }}
            {{>jkafModal class="fa fa-pencil" doc=this template="updateTopicModalForm" id="updateTopicModalForm"}}
        {{/if}}
        {{#if can "delete-topic" "topic" }}
            {{#if hasSubTopic _id}}
                {{> deleteTopicModalForm}}
            {{/if}}
        {{/if}}
        {{#if can "add-article-to-topic" "topic" }}
            <a class="fa fa-long-arrow-right" href="{{searchUrl}}"></a>
        {{/if}}
    </div>
</template>
